local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Основное окно с автосохранением в файл perdoleAIM
local Window = Rayfield:CreateWindow({
   Name = "Perdole Suite v2",
   LoadingTitle = "Загрузка систем...",
   LoadingSubtitle = "by Gemini",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "PerdoleScripts", 
      FileName = "perdoleAIM" -- Тот самый файл
   }
})

-- Настройки
local Settings = {
    AimbotEnabled = false,
    SilentAim = true,
    TeamCheck = true,
    WallCheck = true,
    FOV = 150,
    VisualRay = true,
    AntiAimEnabled = false,
    TriggerBot = false,
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")
local Stats = game:GetService("Stats")

--- СОЗДАНИЕ ПЛАВАЮЩЕГО HUD (FPS/ПИНГ/СТАТУС) ---
local HudGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
HudGui.Name = "PerdoleHUD"

local MainFrame = Instance.new("Frame", HudGui)
MainFrame.Size = UDim2.new(0, 150, 0, 80)
MainFrame.Position = UDim2.new(0, 50, 0.8, 0) -- Слева снизу
MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true -- Делаем его передвигаемым

local Corner = Instance.new("UICorner", MainFrame)
local TextLabel = Instance.new("TextLabel", MainFrame)
TextLabel.Size = UDim2.new(1, -10, 1, -10)
TextLabel.Position = UDim2.new(0, 5, 0, 5)
TextLabel.BackgroundTransparency = 1
TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TextLabel.TextSize = 14
TextLabel.Font = Enum.Font.Code
TextLabel.TextXAlignment = Enum.TextXAlignment.Left
TextLabel.RichText = true

--- ВИЗУАЛИЗАЦИЯ ЛИНИИ АИМБОТА ---
local AimBeam = Instance.new("Part", workspace)
AimBeam.Anchored = true
AimBeam.CanCollide = false
AimBeam.Transparency = 1
local SelectionPart = Instance.new("BoxHandleAdornment", AimBeam)
SelectionPart.Adornee = nil
SelectionPart.AlwaysOnTop = true
SelectionPart.ZIndex = 10
SelectionPart.Size = Vector3.new(0.2, 0.2, 1)
SelectionPart.Color3 = Color3.fromRGB(255, 0, 0)

--- ЛОГИКА ОБНОВЛЕНИЯ ДАННЫХ ---
local function GetClosestPlayer()
    local closest = nil
    local shortestDistance = math.huge
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if Settings.TeamCheck and player.Team == LocalPlayer.Team then continue end
            
            local pos, onScreen = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                local distance = (Vector2.new(pos.X, pos.Y) - Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)).Magnitude
                if distance < Settings.FOV and distance < shortestDistance then
                    closest = player
                    shortestDistance = distance
                end
            end
        end
    end
    return closest
end

-- Основной цикл
RunService.RenderStepped:Connect(function()
    -- Обновление текста HUD
    local fps = math.floor(1 / RunService.RenderStepped:Wait())
    local ping = math.floor(Stats.Network.ServerStatsItem["Data Ping"]:GetValue())
    local aimStatus = Settings.AimbotEnabled and "<font color='#00FF00'>ON</font>" or "<font color='#FF0000'>OFF</font>"
    
    TextLabel.Text = string.format(
        "FPS: %d\nPING: %d ms\nAIMBOT: %s",
        fps, ping, aimStatus
    )

    -- Визуализация наводки
    local target = GetClosestPlayer()
    if Settings.AimbotEnabled and target and Settings.VisualRay then
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            SelectionPart.Adornee = target.Character.HumanoidRootPart
            SelectionPart.Visible = true
        end
    else
        SelectionPart.Visible = false
    end
end)

--- ТАБЫ И КНОПКИ ---
local MainTab = Window:CreateTab("Combat", 4483362458)

MainTab:CreateToggle({
   Name = "Включить Aimbot",
   CurrentValue = false,
   Flag = "AimToggle", -- Флаг для сохранения
   Callback = function(Value)
      Settings.AimbotEnabled = Value
   end,
})

MainTab:CreateToggle({
   Name = "Показывать луч аимбота",
   CurrentValue = true,
   Flag = "VisualRay",
   Callback = function(Value)
      Settings.VisualRay = Value
   end,
})

MainTab:CreateSlider({
   Name = "FOV (Радиус наводки)",
   Range = {0, 800},
   Increment = 10,
   Suffix = "px",
   CurrentValue = 150,
   Flag = "AimFOV",
   Callback = function(Value)
      Settings.FOV = Value
   end,
})

-- Автозагрузка конфига
Rayfield:LoadConfiguration()

