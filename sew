-- // СЕРВИСЫ //
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- // ЗАГРУЗКА БИБЛИОТЕКИ (БЕЗОПАСНАЯ) //
local success, WindUI = pcall(function()
    return loadstring(game:HttpGet("https://raw.githubusercontent.com/Footagesus/WindUI/main/source.lua"))()
end)

if not success or not WindUI then
    warn("FATAL: Could not load WindUI. Check your executor or connection.")
    return
end

-- // КОНФИГУРАЦИЯ //
local Config = {
    -- Aim
    AimEnabled = false,
    AimKey = Enum.UserInputType.MouseButton2,
    AimPart = "Head",
    AimRadius = 150,
    AimSmoothness = 0.5,
    CheckWalls = true,
    CheckTeam = true,
    -- Visuals
    FOVEnabled = true,
    FOVColor = Color3.fromRGB(255, 255, 255),
    ESPEnabled = false,
    ESPNames = false,
    ESPFillColor = Color3.fromRGB(255, 105, 180),
    ESPOutlineColor = Color3.fromRGB(255, 255, 255)
}

-- // ПЕРЕМЕННЫЕ ЛОГИКИ //
local FOVCircle = nil
pcall(function()
    FOVCircle = Drawing.new("Circle")
    FOVCircle.Thickness = 1
    FOVCircle.NumSides = 60
    FOVCircle.Filled = false
    FOVCircle.Transparency = 1
    FOVCircle.Visible = false
end)

local ESPContainer = {}
local isAiming = false

-- // ФУНКЦИИ ЛОГИКИ //

local function IsVisible(targetPart)
    if not Config.CheckWalls then return true end
    local rayParams = RaycastParams.new()
    rayParams.FilterDescendantsInstances = {LocalPlayer.Character, targetPart.Parent}
    rayParams.FilterType = Enum.RaycastFilterType.Exclude
    local result = Workspace:Raycast(Camera.CFrame.Position, (targetPart.Position - Camera.CFrame.Position), rayParams)
    return result == nil
end

local function GetClosestTarget()
    local closest = nil
    local shortestDist = Config.AimRadius

    for _, player in ipairs(Players:GetPlayers()) do
        if player == LocalPlayer or (Config.CheckTeam and player.Team == LocalPlayer.Team) then continue end
        
        local char = player.Character
        local part = char and char:FindFirstChild(Config.AimPart)
        local hum = char and char:FindFirstChild("Humanoid")

        if part and hum and hum.Health > 0 then
            local pos, onScreen = Camera:WorldToScreenPoint(part.Position)
            if onScreen then
                local mouseDist = (Vector2.new(pos.X, pos.Y) - Vector2.new(Mouse.X, Mouse.Y)).Magnitude
                if mouseDist < shortestDist and IsVisible(part) then
                    shortestDist = mouseDist
                    closest = part
                end
            end
        end
    end
    return closest
end

local function UpdateESP()
    if not Config.ESPEnabled then
        for _, obj in pairs(ESPContainer) do
            if obj.Highlight then obj.Highlight:Destroy() end
            if obj.Billboard then obj.Billboard:Destroy() end
        end
        ESPContainer = {}
        return
    end

    for _, player in ipairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character then
            if Config.CheckTeam and player.Team == LocalPlayer.Team then 
                if ESPContainer[player] then
                    if ESPContainer[player].Highlight then ESPContainer[player].Highlight:Destroy() end
                    if ESPContainer[player].Billboard then ESPContainer[player].Billboard:Destroy() end
                    ESPContainer[player] = nil
                end
                continue 
            end

            local char = player.Character
            if not ESPContainer[player] then ESPContainer[player] = {} end

            -- Highlight
            if not char:FindFirstChild("WindUI_Highlight") then
                local hl = Instance.new("Highlight", char)
                hl.Name = "WindUI_Highlight"
                hl.FillTransparency = 0.5
                ESPContainer[player].Highlight = hl
            end
            local hl = char:FindFirstChild("WindUI_Highlight")
            hl.FillColor = Config.ESPFillColor
            hl.OutlineColor = Config.ESPOutlineColor

            -- Names
            local head = char:FindFirstChild("Head")
            if head and Config.ESPNames then
                if not head:FindFirstChild("WindUI_NameTag") then
                    local bb = Instance.new("BillboardGui", head)
                    bb.Name = "WindUI_NameTag"
                    bb.Size = UDim2.new(0, 200, 0, 50)
                    bb.StudsOffset = Vector3.new(0, 2, 0)
                    bb.AlwaysOnTop = true
                    local txt = Instance.new("TextLabel", bb)
                    txt.Size = UDim2.new(1,0,1,0)
                    txt.BackgroundTransparency = 1
                    txt.TextColor3 = Color3.white
                    txt.Font = Enum.Font.GothamBold
                    txt.TextSize = 12
                    txt.Text = player.DisplayName
                    ESPContainer[player].Billboard = bb
                end
            elseif head and head:FindFirstChild("WindUI_NameTag") and not Config.ESPNames then
                head.WindUI_NameTag:Destroy()
            end
        end
    end
end

-- // ИНТЕРФЕЙС //

local Window = WindUI:CreateWindow({
    Title = "slrNova - Full Script",
    Icon = "solar:shield-check-bold",
    Author = "slrNova",
    Folder = "WindV2_Configs",
    Size = UDim2.fromOffset(580, 460),
    Transparent = true,
    Theme = "Dark",
    HasOutline = true
})

-- Вкладка Бой
local CombatTab = Window:Tab({ Title = "Combat", Icon = "solar:bolt-bold" })
local AimSec = CombatTab:Section({ Title = "Aimbot Settings" })

AimSec:Toggle({
    Title = "Enable Aimbot",
    Default = Config.AimEnabled,
    Callback = function(v) Config.AimEnabled = v end
})

AimSec:Dropdown({
    Title = "Target Part",
    Items = {"Head", "UpperTorso", "HumanoidRootPart"},
    Default = "Head",
    Callback = function(v) Config.AimPart = v end
})

AimSec:Slider({
    Title = "Smoothness",
    Min = 0, Max = 0.95, Step = 0.05,
    Default = Config.AimSmoothness,
    Callback = function(v) Config.AimSmoothness = v end
})

local AimMisc = CombatTab:Section({ Title = "Aim Misc" })

AimMisc:Toggle({
    Title = "Wall Check",
    Default = Config.CheckWalls,
    Callback = function(v) Config.CheckWalls = v end
})

AimMisc:Toggle({
    Title = "Team Check",
    Default = Config.CheckTeam,
    Callback = function(v) Config.CheckTeam = v end
})

AimMisc:Keybind({
    Title = "Aim Keybind",
    Default = Enum.UserInputType.MouseButton2,
    ChangedCallback = function(v) Config.AimKey = v end
})

-- Вкладка Визуалы
local VisualsTab = Window:Tab({ Title = "Visuals", Icon = "solar:eye-bold" })
local EspSec = VisualsTab:Section({ Title = "Player ESP" })

EspSec:Toggle({
    Title = "Enable ESP",
    Default = Config.ESPEnabled,
    Callback = function(v) Config.ESPEnabled = v end
})

EspSec:Toggle({
    Title = "Show Names",
    Default = Config.ESPNames,
    Callback = function(v) Config.ESPNames = v end
})

EspSec:ColorPicker({
    Title = "Fill Color",
    Default = Config.ESPFillColor,
    Callback = function(v) Config.ESPFillColor = v end
})

local FovSec = VisualsTab:Section({ Title = "FOV Settings" })

FovSec:Toggle({
    Title = "Show FOV Circle",
    Default = Config.FOVEnabled,
    Callback = function(v) Config.FOVEnabled = v end
})

FovSec:Slider({
    Title = "FOV Radius",
    Min = 30, Max = 600, Default = Config.AimRadius,
    Callback = function(v) 
        Config.AimRadius = v 
        if FOVCircle then FOVCircle.Radius = v end
    end
})

-- Вкладка Настройки
local SettingsTab = Window:Tab({ Title = "Settings", Icon = "solar:settings-bold" })
SettingsTab:Section({ Title = "Unload" }):Button({
    Title = "Destroy UI & Stop",
    Callback = function()
        if FOVCircle then FOVCircle:Remove() end
        Window:Destroy()
        Config.ESPEnabled = false
        UpdateESP()
    end
})

-- // ЦИКЛЫ //

UserInputService.InputBegan:Connect(function(i, g)
    if not g and (i.UserInputType == Config.AimKey or i.KeyCode == Config.AimKey) then isAiming = true end
end)

UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType == Config.AimKey or i.KeyCode == Config.AimKey then isAiming = false end
end)

RunService.RenderStepped:Connect(function()
    if FOVCircle then
        FOVCircle.Visible = Config.FOVEnabled
        FOVCircle.Position = Vector2.new(Mouse.X, Mouse.Y + 36)
        FOVCircle.Color = Config.FOVColor
    end

    if Config.AimEnabled and isAiming then
        local target = GetClosestTarget()
        if target then
            local goal = CFrame.new(Camera.CFrame.Position, target.Position)
            Camera.CFrame = Camera.CFrame:Lerp(goal, 1 - Config.AimSmoothness)
        end
    end
end)

task.spawn(function()
    while task.wait(0.5) do UpdateESP() end
end)

WindUI:Notify({
    Title = "System Ready",
    Content = "All modules loaded successfully.",
    Icon = "solar:check-circle-bold",
    Duration = 3
})
